<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Super Loja QA ‚Äî Funcional</title>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/1170/1170678.png" />
  <style>
    :root{--primary:#3483fa;--accent:#ffe600;--success:#00a650;--bg:#f1f1f1}
    *{box-sizing:border-box}
    body{font-family:'Segoe UI',Tahoma, Geneva, Verdana, sans-serif;margin:0;background:var(--bg);color:#222}
    header{background:var(--accent);padding:14px 0;box-shadow:0 2px 4px rgba(0,0,0,.08);position:sticky;top:0;z-index:50}
    .header-inner{max-width:1200px;margin:0 auto;display:flex;align-items:center;gap:16px;padding:0 20px}
    .logo{font-weight:700;font-size:20px;color:#222}
    .search-bar{flex:1;display:flex}
    .search-bar input{flex:1;padding:10px;border-radius:6px 0 0 6px;border:1px solid #ccc;border-right:0}
    .search-bar button{padding:10px 14px;border-radius:0 6px 6px 0;border:1px solid #ccc;background:var(--primary);color:#fff;cursor:pointer}
    .banner{background:url('https://picsum.photos/1200/250?blur=3') center/cover;height:220px;display:flex;align-items:center;justify-content:flex-start;color:#111;padding-left:40px;font-size:28px;font-weight:700}
    main{max-width:1200px;margin:20px auto;padding:0 20px}
    .controls{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .filters{display:flex;gap:10px}
    .filter-btn{padding:8px 14px;border-radius:20px;border:1px solid #ddd;background:#fff;cursor:pointer}
    .products{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:20px;margin-top:20px}
    .card{background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.06);transition:transform .14s}
    .card:hover{transform:translateY(-6px)}
    .card img{width:100%;height:180px;object-fit:cover}
    .info{padding:12px}
    .title{font-size:16px;margin:6px 0}
    .price{color:var(--success);font-weight:700;font-size:18px}
    .actions{display:flex;gap:8px;margin-top:10px}
    .btn{padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
    .btn-primary{background:var(--primary);color:#fff}
    .btn-secondary{background:#f3f3f3}
    /* cart aside */
    .cart-aside{position:fixed;top:0;right:-420px;width:380px;height:100%;background:#fff;box-shadow:-6px 0 18px rgba(0,0,0,.12);transition:right .28s ease;z-index:60;display:flex;flex-direction:column}
    .cart-aside.open{right:0}
    .cart-header{padding:18px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center}
    .cart-list{flex:1;overflow:auto;padding:12px 18px;list-style:none;margin:0}
    .cart-item{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #f0f0f0}
    .cart-footer{padding:14px;border-top:1px solid #eee}
    .coupon-row{display:flex;gap:8px;margin-top:8px}
    .coupon-row input{flex:1;padding:8px;border:1px solid #ddd;border-radius:6px}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;z-index:55}
    .overlay.show{display:block}
    .modal-error{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:#fff;padding:18px;border-radius:8px;box-shadow:0 8px 30px rgba(0,0,0,.18);z-index:70;display:none;max-width:420px;width:90%}
    footer{background:#222;color:#ddd;text-align:center;padding:18px;margin-top:36px}
    /* responsive */
    @media(max-width:720px){.cart-aside{width:100%;}.banner{font-size:20px;padding-left:18px;height:150px}.products{grid-template-columns:repeat(auto-fill,minmax(180px,1fr))}}
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <div class="logo">Super Loja QA</div>
      <div class="search-bar">
        <input id="search-input" placeholder="Buscar produtos..." />
        <button id="search-btn">Buscar</button>
      </div>
      <div style="min-width:120px;text-align:right">Bem-vindo ‚Äî Treino QA</div>
    </div>
  </header>

  <div class="banner">Ofertas imperd√≠veis ‚Äî pratique QA com falhas intencionais</div>

  <main>
    <div class="controls">
      <div class="filters">
        <button class="filter-btn" data-filter="all">Todos</button>
        <button class="filter-btn" data-filter="eletronicos">Eletr√¥nicos</button>
        <button class="filter-btn" data-filter="casal">Casa</button>
        <button class="filter-btn" data-filter="oficina">Oficina</button>
      </div>
      <div>
        <select id="sort-select"><option value="popular">Mais popular</option><option value="preco-asc">Pre√ßo - menor</option><option value="preco-desc">Pre√ßo - maior</option></select>
      </div>
    </div>

    <section class="products" id="products">
      <!-- products rendered from JS -->
    </section>
  </main>

  <div class="overlay" id="overlay"></div>

  <aside class="cart-aside" id="cart-aside" aria-hidden="true">
    <div class="cart-header"><strong>üõí Seu Carrinho</strong><button class="btn btn-secondary" id="btn-close-cart">Fechar</button></div>
    <ul class="cart-list" id="cart-list"></ul>
    <div class="cart-footer">
      <div>Total: <strong id="cart-total">R$ 0,00</strong></div>
      <div class="coupon-row">
        <input id="coupon-input" placeholder="C√≥digo promocional" />
        <button id="apply-coupon" class="btn btn-primary">Aplicar</button>
      </div>
      <div style="margin-top:10px">
        <button id="btn-checkout" class="btn btn-primary" style="width:100%">Finalizar compra</button>
      </div>
    </div>
  </aside>

  <div class="modal-error" id="modal-error" role="dialog" aria-modal="true">
    <h3>‚ùå Erro ao aplicar cupom</h3>
    <p id="modal-error-msg">O sistema n√£o conseguiu validar seu cupom no momento. Por favor, tente novamente.</p>
    <div style="text-align:right;margin-top:12px"><button id="close-modal-btn" class="btn btn-primary">Entendi</button></div>
  </div>

  <footer>¬© 2025 Super Loja QA ‚Äî Exerc√≠cio para estudantes de Quality Assurance.</footer>

<script>
/* --- Dados de produtos (mant√©m diverg√™ncias intencionais entre pre√ßo mostrado e data-price) --- */
const PRODUCTS = [
  { id:'p1', title:'Smartfone X', priceVisible:19.99, priceData:29.99, category:'eletronicos', img:'https://picsum.photos/seed/phone/400/300' },
  { id:'p2', title:'Jogo de Len√ß√≥is King', priceVisible:49.90, priceData:49.90, category:'casal', img:'https://picsum.photos/seed/bed/400/300' },
  { id:'p3', title:'Furadeira Turbo', priceVisible:159.00, priceData:199.00, category:'oficina', img:'https://picsum.photos/seed/drill/400/300' },
  { id:'p4', title:'Fone Sem Fio', priceVisible:9.50, priceData:9.50, category:'eletronicos', img:'https://picsum.photos/seed/earbuds/400/300' },
  { id:'p5', title:'Cabo USB-C', priceVisible:5.00, priceData:5.00, category:'eletro', img:'https://picsum.photos/seed/cable/400/300' }
];

/* Estado do carrinho */
const CART = { items: [] };

/* Helpers */
function formatBRL(n){ return 'R$ '+Number(n).toFixed(2).replace('.',','); }
function qs(sel){ return document.querySelector(sel); }
function qsa(sel){ return Array.from(document.querySelectorAll(sel)); }

/* --- Render products --- */
function renderProducts(list){
  const container = qs('#products');
  container.innerHTML = '';
  list.forEach(p=>{
    const card = document.createElement('article');
    card.className = 'card';
    card.dataset.id = p.id;
    card.dataset.category = p.category;
    card.innerHTML = `
      <img src="${p.img}" alt="${p.title}" />
      <div class="info">
        <div class="title">${p.title}</div>
        <div class="price">${formatBRL(p.priceVisible)}</div>
        <div class="actions">
          <button class="btn btn-primary btn-buy" data-id="${p.id}">Comprar</button>
          <button class="btn btn-secondary btn-add" data-id="${p.id}" data-price="${p.priceData}">Adicionar</button>
        </div>
      </div>`;
    container.appendChild(card);
  });
}

/* Initial render */
renderProducts(PRODUCTS);

/* --- Event delegation for product actions (robust) --- */
qs('#products').addEventListener('click', (ev)=>{
  const buyBtn = ev.target.closest('.btn-buy');
  const addBtn = ev.target.closest('.btn-add');
  if(buyBtn){
    const id = buyBtn.dataset.id;
    handleBuy(id);
    return;
  }
  if(addBtn){
    const id = addBtn.dataset.id;
    const price = parseFloat(addBtn.dataset.price);
    handleAddToCart(id, price);
    return;
  }
});

/* Filters */
qsa('.filter-btn').forEach(btn=>btn.addEventListener('click', ()=>{
  const f = btn.dataset.filter;
  // Map small mismatch (eletro -> eletronicos) so filters are forgiving
  const mapping = { 'eletro':'eletronicos' };
  const target = mapping[f] || f;
  if(target === 'all'){ renderProducts(PRODUCTS); return; }
  renderProducts(PRODUCTS.filter(p=>p.category===target));
}));

/* Sort */
qs('#sort-select').addEventListener('change', (e)=>{
  const v = e.target.value;
  let arr = [...PRODUCTS];
  if(v==='preco-asc') arr.sort((a,b)=>a.priceData - b.priceData);
  else if(v==='preco-desc') arr.sort((a,b)=>b.priceData - a.priceData);
  renderProducts(arr);
});

/* Search */
qs('#search-btn').addEventListener('click', ()=>{
  const q = qs('#search-input').value.trim().toLowerCase();
  if(!q){ renderProducts(PRODUCTS); return; }
  renderProducts(PRODUCTS.filter(p=>p.title.toLowerCase().includes(q)));
});

/* --- Cart behaviors --- */
function handleAddToCart(id, price){
  CART.items.push({ id, price });
  updateCartUI();
  openCart();
}

function updateCartUI(){
  const list = qs('#cart-list');
  list.innerHTML = '';
  CART.items.forEach((it, idx)=>{
    const prod = PRODUCTS.find(p=>p.id===it.id);
    const li = document.createElement('li');
    li.className = 'cart-item';
    li.innerHTML = `<div>${prod.title} <div style="font-size:12px;color:#666">qtd:1</div></div><div>${formatBRL(it.price)}</div>`;
    list.appendChild(li);
  });
  const total = CART.items.reduce((s,i)=>s+Number(i.price||0),0);
  qs('#cart-total').innerText = formatBRL(total);
}

function openCart(){
  qs('#cart-aside').classList.add('open');
  qs('#overlay').classList.add('show');
  qs('#cart-aside').setAttribute('aria-hidden','false');
}
function closeCart(){
  qs('#cart-aside').classList.remove('open');
  qs('#overlay').classList.remove('show');
  qs('#cart-aside').setAttribute('aria-hidden','true');
}
qs('#btn-close-cart').addEventListener('click', closeCart);
qs('#overlay').addEventListener('click', closeCart);

/* Checkout (buy) -> open an error page (styled) using data URL */
function handleBuy(id){
  // build a styled error page that follows the identity visual
  const product = PRODUCTS.find(p=>p.id===id);
  const html = `<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Erro - Super Loja QA</title><style>body{font-family:Segoe UI,Arial;background:#fff;margin:0;padding:0}header{background:var(--accent);padding:16px;text-align:center;background:#ffe600}main{max-width:800px;margin:40px auto;padding:20px;text-align:center}h1{color:#c62828}p{color:#333}a.button{display:inline-block;margin-top:18px;padding:10px 16px;background:#3483fa;color:#fff;border-radius:8px;text-decoration:none}</style></head><body><header><h2>Super Loja QA</h2></header><main><h1>500 ‚Äî Erro inesperado ao processar a compra</h1><p>Desculpe, ocorreu um erro ao tentar iniciar a compra do produto: <strong>${product.title}</strong>.</p><p>Isso pode ser intencional para o exerc√≠cio de QA ‚Äî pe√ßa aos alunos que verifiquem console, rede e fluxo de checkout.</p><a class="button" href="javascript:history.back()">Voltar √† loja</a></main></body></html>`;
  // open via data URL in same tab
  window.location.href = 'data:text/html;charset=utf-8,' + encodeURIComponent(html);
}

/* Coupon flow ‚Äî show modal with failure (but functional UI) */
qs('#apply-coupon').addEventListener('click', ()=>{
  const code = qs('#coupon-input').value.trim();
  // simulate network request
  setTimeout(()=>{
    // intentionally 'fail' validation but UI shows error modal reliably
    qs('#modal-error-msg').innerText = `O cupom "${code || '---'}" n√£o p√¥de ser aplicado. (Erro de valida√ß√£o)`;
    qs('#modal-error').style.display = 'block';
    qs('#overlay').classList.add('show');
  }, 400);
});
qs('#close-modal-btn').addEventListener('click', ()=>{qs('#modal-error').style.display='none';qs('#overlay').classList.remove('show');});

/* Checkout button in aside: complete purchase (keeps intentionally simple) */
qs('#btn-checkout').addEventListener('click', ()=>{
  // simulate success but keep note that no real payment is processed
  alert('Pagamento conclu√≠do com sucesso! (exerc√≠cio)');
  CART.items = [];
  updateCartUI();
  closeCart();
});

// ensure keyboard accessibility: Esc closes modals/aside
window.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape'){
    if(qs('#modal-error').style.display==='block') qs('#close-modal-btn').click();
    if(qs('#cart-aside').classList.contains('open')) closeCart();
  }
});

</script>
</body>
</html>
